<% form_class = @book.memos.find_by_user_id(current_user.id) ? "" : "in"  %>

<div class="memo-form collapse <%= form_class %>">

  <%= simple_form_for [@book, @memo], url: my_book_memos_path(@book) do |f| %>
    <%= f.input :body %>
    <%= f.input :public, label: 'Do you want to share this memo with the public?' %>

    <%= f.error :segments %>
    <div id="segments">
      <%= f.simple_fields_for :segments do |r| %>
        <%= render "/my/memos/segment_fields", f: r %>
      <% end %>
      <div class="links">
        <%= link_to_add_association 'add new segment', f, :segments, partial: "/my/memos/segment_fields", class: "btn btn-success btn-sm" %>
      </div>
    </div>
    <%= f.submit data: {disable_with: "submitting..."}, class: "btn btn-primary" %>
  <% end %>

  <%= @memo.errors.full_messages.join(", ") %>
  <br>

</div>
